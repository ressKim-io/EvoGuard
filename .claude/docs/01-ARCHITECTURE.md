# ğŸ“ 01. ìƒì„¸ ì•„í‚¤í…ì²˜

> Content Arena ì‹œìŠ¤í…œì˜ ì „ì²´ ì•„í‚¤í…ì²˜ ë° ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

---

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    CLIENT                                       â”‚
â”‚                          (Dashboard / API Consumer)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API GATEWAY (Go/Gin)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Battle API  â”‚  â”‚ Model API   â”‚  â”‚ Metrics API â”‚  â”‚ Health / Readiness      â”‚ â”‚
â”‚  â”‚ /battles/*  â”‚  â”‚ /models/*   â”‚  â”‚ /metrics    â”‚  â”‚ /health, /ready         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CORE SERVICES LAYER                                   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   BATTLE SERVICE     â”‚  â”‚   ATTACKER SERVICE   â”‚  â”‚   DEFENDER SERVICE     â”‚â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚  â”‚                        â”‚â”‚
â”‚  â”‚ - ë¼ìš´ë“œ ê´€ë¦¬        â”‚  â”‚ - ìš°íšŒ íŒ¨í„´ ìƒì„±    â”‚  â”‚ - ì½˜í…ì¸  ë¶„ë¥˜          â”‚â”‚
â”‚  â”‚ - ê²°ê³¼ ì§‘ê³„          â”‚  â”‚ - ì „ëµ ì„ íƒ         â”‚  â”‚ - íƒì§€ íŒì •            â”‚â”‚
â”‚  â”‚ - íŠ¸ë¦¬ê±° ë°œí–‰        â”‚  â”‚ - LLM í˜¸ì¶œ          â”‚  â”‚ - ì‹ ë¢°ë„ ì ìˆ˜          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚            â”‚                        â”‚                          â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚                          â”‚
             â–¼                        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ML LAYER (Python)                                  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   OLLAMA SERVICE     â”‚  â”‚   INFERENCE SERVICE  â”‚  â”‚   TRAINING SERVICE     â”‚â”‚
â”‚  â”‚   (ë¡œì»¬ LLM)         â”‚  â”‚   (ëª¨ë¸ ì„œë¹™)        â”‚  â”‚   (QLoRA Fine-tune)    â”‚â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚  â”‚                        â”‚â”‚
â”‚  â”‚ Mistral 7B Q4        â”‚  â”‚ BERT / Fine-tuned    â”‚  â”‚ Transformers + PEFT    â”‚â”‚
â”‚  â”‚ :11434               â”‚  â”‚ FastAPI :8001        â”‚  â”‚ Background Worker      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚                          â”‚
             â–¼                        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA LAYER                                         â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   PostgreSQL     â”‚  â”‚     Redis        â”‚  â”‚         MLflow               â”‚  â”‚
â”‚  â”‚   (ë©”ì¸ DB)      â”‚  â”‚   (ìºì‹œ/í)      â”‚  â”‚   (ì‹¤í—˜ ì¶”ì /ëª¨ë¸ ì €ì¥)      â”‚  â”‚
â”‚  â”‚   :5432          â”‚  â”‚   :6379          â”‚  â”‚   :5000                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        File Storage (models/, data/)                     â”‚  â”‚
â”‚  â”‚   - í•™ìŠµ ë°ì´í„°ì…‹                                                        â”‚  â”‚
â”‚  â”‚   - ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸                                                      â”‚  â”‚
â”‚  â”‚   - LoRA ì–´ëŒ‘í„°                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚                          â”‚
             â–¼                        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OBSERVABILITY LAYER                                   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Prometheus        â”‚  â”‚     Grafana          â”‚  â”‚   MLflow UI            â”‚â”‚
â”‚  â”‚   (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)     â”‚  â”‚   (ëŒ€ì‹œë³´ë“œ)         â”‚  â”‚   (ì‹¤í—˜ ì¶”ì )          â”‚â”‚
â”‚  â”‚   :9090             â”‚  â”‚   :3000              â”‚  â”‚   :5000                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ í•µì‹¬ í”Œë¡œìš°

### 1. Battle Flow (ë°°í‹€ ì‹¤í–‰ í”Œë¡œìš°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BATTLE FLOW                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Client                API Gateway          Battle Service       Attacker
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚  POST /battles       â”‚                      â”‚                 â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                 â”‚
        â”‚                      â”‚  CreateBattle()      â”‚                 â”‚
        â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚                      â”‚                      â”‚  for each round â”‚
        â”‚                      â”‚                      â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â–ºâ”‚
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚                      â”‚                      â”‚  GenerateEvasion()
        â”‚                      â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                      â”‚                      â”‚                 â”‚
     Defender             Inference Service           â”‚                 â”‚
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚  Classify()          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                 â”‚
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚  {toxic: 0.85}       â”‚                      â”‚                 â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  RecordResult()      â”‚                 â”‚
        â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚                      â”‚                      â”‚  CheckThreshold()
        â”‚                      â”‚                      â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â–ºâ”‚
        â”‚                      â”‚                      â”‚                 â”‚
        â”‚                      â”‚  battle_completed    â”‚  (ì´ë²¤íŠ¸ ë°œí–‰)  â”‚
        â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
        â”‚                      â”‚                      â”‚                 â”‚
```

### 2. Auto Retrain Flow (ìë™ ì¬í•™ìŠµ í”Œë¡œìš°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AUTO RETRAIN FLOW                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Battle Service        Redis (Event)      Training Service      MLflow
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚  battle_completed   â”‚                    â”‚                 â”‚
        â”‚  evasion_rate > 30% â”‚                    â”‚                 â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                 â”‚
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚                     â”‚  TRIGGER_RETRAIN   â”‚                 â”‚
        â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚                     â”‚                    â”‚  CollectData()  â”‚
        â”‚                     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚                     â”‚                    â”‚  StartTraining()â”‚
        â”‚                     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚                     â”‚                    â”‚  QLoRA Fine-tuneâ”‚
        â”‚                     â”‚                    â”‚  (ë¡œì»¬ GPU)     â”‚
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚                     â”‚                    â”‚  LogMetrics()   â”‚
        â”‚                     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                     â”‚                    â”‚                 â”‚
        â”‚                     â”‚                    â”‚  RegisterModel()â”‚
        â”‚                     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                     â”‚                    â”‚  as "challenger"â”‚
        â”‚                     â”‚                    â”‚                 â”‚
```

### 3. Champion/Challenger Flow (ëª¨ë¸ êµì²´ í”Œë¡œìš°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHAMPION/CHALLENGER FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Training Service       MLflow          Evaluation Service    Inference Service
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚  model_trained   â”‚                    â”‚                     â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                     â”‚
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚  new_challenger    â”‚                     â”‚
        â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚                    â”‚  LoadTestSet()      â”‚
        â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚                    â”‚  EvaluateChampion() â”‚
        â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                  â”‚                    â”‚  (í˜„ì¬ ëª¨ë¸)        â”‚
        â”‚                  â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                  â”‚                    â”‚  F1: 0.82           â”‚
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚                    â”‚  EvaluateChallenger()
        â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                  â”‚                    â”‚  (ìƒˆ ëª¨ë¸)          â”‚
        â”‚                  â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                  â”‚                    â”‚  F1: 0.87           â”‚
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚                    â”‚  if challenger > champion
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚  PromoteChallenger â”‚                     â”‚
        â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
        â”‚                  â”‚  set alias=championâ”‚                     â”‚
        â”‚                  â”‚                    â”‚                     â”‚
        â”‚                  â”‚                    â”‚  ReloadModel()      â”‚
        â”‚                  â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                  â”‚                    â”‚  (ìƒˆ champion ë¡œë“œ) â”‚
        â”‚                  â”‚                    â”‚                     â”‚
```

---

## ğŸ§© ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 1. API Gateway (Go/Gin)

```go
// ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸
POST   /api/v1/battles              // ìƒˆ ë°°í‹€ ìƒì„±
GET    /api/v1/battles/:id          // ë°°í‹€ ìƒíƒœ ì¡°íšŒ
GET    /api/v1/battles/:id/rounds   // ë¼ìš´ë“œ ê²°ê³¼ ëª©ë¡
POST   /api/v1/battles/:id/stop     // ë°°í‹€ ì¤‘ì§€

GET    /api/v1/models               // ëª¨ë¸ ëª©ë¡
GET    /api/v1/models/:alias        // íŠ¹ì • ëª¨ë¸ ì •ë³´ (champion/challenger)
POST   /api/v1/models/promote       // Challenger â†’ Champion ìŠ¹ê²©

GET    /api/v1/metrics              // Prometheus ë©”íŠ¸ë¦­
GET    /api/v1/metrics/quality      // í’ˆì§ˆ ì¶”ì´ ë°ì´í„°

GET    /health                      // í—¬ìŠ¤ ì²´í¬
GET    /ready                       // ë ˆë””ë‹ˆìŠ¤ ì²´í¬
```

**ì±…ì„:**
- HTTP ìš”ì²­ ë¼ìš°íŒ…
- ìš”ì²­ ê²€ì¦ ë° ë³€í™˜
- ì‘ë‹µ ì§ë ¬í™”
- ë¯¸ë“¤ì›¨ì–´ (ì¸ì¦, ë¡œê¹…, ë©”íŠ¸ë¦­)

### 2. Battle Service (Go)

```go
// í•µì‹¬ ë¡œì§
type BattleService struct {
    repo       BattleRepository
    attacker   AttackerClient
    defender   DefenderClient
    eventBus   EventBus
}

func (s *BattleService) RunBattle(config BattleConfig) (*Battle, error) {
    battle := s.repo.Create(config)
    
    for round := 1; round <= config.Rounds; round++ {
        // 1. ê³µê²©ì: ìš°íšŒ íŒ¨í„´ ìƒì„±
        evasion := s.attacker.GenerateEvasion(config.Strategy, round)
        
        // 2. ë°©ì–´ì: íƒì§€ ì‹œë„
        result := s.defender.Classify(evasion.Text)
        
        // 3. ê²°ê³¼ ê¸°ë¡
        s.repo.RecordRound(battle.ID, round, evasion, result)
        
        // 4. ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        s.updateMetrics(battle.ID, result)
    }
    
    // 5. ë°°í‹€ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œí–‰
    s.eventBus.Publish("battle_completed", battle)
    
    return battle, nil
}
```

**ì±…ì„:**
- ë°°í‹€ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬
- ë¼ìš´ë“œë³„ ê²°ê³¼ ì§‘ê³„
- íŠ¸ë¦¬ê±° ì¡°ê±´ í‰ê°€
- ì´ë²¤íŠ¸ ë°œí–‰

### 3. Attacker Service (Python/Ollama)

```python
# ê³µê²© ì „ëµ ì¸í„°í˜ì´ìŠ¤
class AttackStrategy(ABC):
    @abstractmethod
    def generate(self, original: str) -> str:
        pass

# ì „ëµ êµ¬í˜„ì²´ë“¤
class UnicodeEvasionStrategy(AttackStrategy):
    """ìœ ë‹ˆì½”ë“œ ë¬¸ì ë³€í˜• ì „ëµ"""
    def generate(self, original: str) -> str:
        # ã……ã…‚ â†’ ã…… ã…‚, ã…†ã…£ë°œ â†’ ã…† ã…£ ë°œ ë“±
        pass

class LLMEvasionStrategy(AttackStrategy):
    """LLMì„ ì´ìš©í•œ ì°½ì˜ì  ìš°íšŒ"""
    def __init__(self, ollama_client):
        self.llm = ollama_client
    
    def generate(self, original: str) -> str:
        prompt = f"""
        ë‹¤ìŒ ë¬¸ì¥ì˜ ì˜ë¯¸ëŠ” ìœ ì§€í•˜ë©´ì„œ 
        ìš•ì„¤ í•„í„°ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ë³€í˜•ì„ ìƒì„±í•˜ì„¸ìš”:
        ì›ë³¸: {original}
        """
        return self.llm.generate(prompt)

class HomoglyphStrategy(AttackStrategy):
    """ë™í˜• ë¬¸ì(homoglyph) ì¹˜í™˜"""
    pass

class InsertionStrategy(AttackStrategy):
    """ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì ì‚½ì…"""
    pass
```

**ì±…ì„:**
- ë‹¤ì–‘í•œ ìš°íšŒ ì „ëµ ì œê³µ
- LLM ê¸°ë°˜ ì°½ì˜ì  ë³€í˜•
- ê³µê²© íŒ¨í„´ ë‹¤ì–‘í™”

### 4. Defender Service (Python/FastAPI)

```python
# ì¶”ë¡  ì„œë¹„ìŠ¤
class DefenderService:
    def __init__(self, model_path: str):
        self.tokenizer = AutoTokenizer.from_pretrained(model_path)
        self.model = AutoModelForSequenceClassification.from_pretrained(model_path)
    
    def classify(self, text: str) -> ClassificationResult:
        inputs = self.tokenizer(text, return_tensors="pt", truncation=True)
        outputs = self.model(**inputs)
        probs = torch.softmax(outputs.logits, dim=-1)
        
        return ClassificationResult(
            toxic_score=probs[0][1].item(),
            is_toxic=probs[0][1].item() > 0.5,
            confidence=max(probs[0]).item()
        )
    
    def reload_model(self, new_model_path: str):
        """Champion ëª¨ë¸ êµì²´ ì‹œ í˜¸ì¶œ"""
        self.model = AutoModelForSequenceClassification.from_pretrained(new_model_path)
```

**ì±…ì„:**
- ì½˜í…ì¸  ë¶„ë¥˜ ì¶”ë¡ 
- ëª¨ë¸ ë¡œë”©/ì–¸ë¡œë”©
- ë°°ì¹˜ ì¶”ë¡  ì§€ì›

### 5. Training Service (Python)

```python
# QLoRA Fine-tuning íŒŒì´í”„ë¼ì¸
class TrainingPipeline:
    def __init__(self, config: TrainingConfig):
        self.config = config
        self.mlflow_client = mlflow.tracking.MlflowClient()
    
    def train(self, dataset_path: str) -> str:
        with mlflow.start_run():
            # 1. ë°ì´í„° ë¡œë“œ
            dataset = load_dataset("json", data_files=dataset_path)
            
            # 2. ëª¨ë¸ & í† í¬ë‚˜ì´ì € ë¡œë“œ (4-bit ì–‘ìí™”)
            model = AutoModelForSequenceClassification.from_pretrained(
                self.config.base_model,
                load_in_4bit=True,
                torch_dtype=torch.bfloat16
            )
            
            # 3. LoRA ì„¤ì •
            peft_config = LoraConfig(
                r=16,
                lora_alpha=32,
                target_modules=["q_proj", "v_proj"],
                lora_dropout=0.05,
                task_type="SEQ_CLS"
            )
            model = get_peft_model(model, peft_config)
            
            # 4. í•™ìŠµ
            trainer = Trainer(
                model=model,
                args=self.config.training_args,
                train_dataset=dataset["train"],
                eval_dataset=dataset["validation"]
            )
            trainer.train()
            
            # 5. í‰ê°€ & ë¡œê¹…
            metrics = trainer.evaluate()
            mlflow.log_metrics(metrics)
            
            # 6. ëª¨ë¸ ì €ì¥ & ë“±ë¡
            model_path = f"models/challenger-{mlflow.active_run().info.run_id}"
            trainer.save_model(model_path)
            
            mlflow.register_model(
                f"runs:/{mlflow.active_run().info.run_id}/model",
                "content-filter",
                tags={"alias": "challenger"}
            )
            
            return model_path
```

**ì±…ì„:**
- QLoRA Fine-tuning ì‹¤í–‰
- MLflow ì‹¤í—˜ ì¶”ì 
- ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ì €ì¥
- Challenger ëª¨ë¸ ë“±ë¡

---

## ğŸ“Š ë°ì´í„° ëª¨ë¸

### PostgreSQL ìŠ¤í‚¤ë§ˆ

```sql
-- ë°°í‹€ í…Œì´ë¸”
CREATE TABLE battles (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    status          VARCHAR(20) NOT NULL DEFAULT 'pending',  -- pending, running, completed, failed
    config          JSONB NOT NULL,                          -- ë°°í‹€ ì„¤ì •
    total_rounds    INTEGER NOT NULL,
    completed_rounds INTEGER DEFAULT 0,
    evasion_count   INTEGER DEFAULT 0,                       -- ìš°íšŒ ì„±ê³µ íšŸìˆ˜
    detection_count INTEGER DEFAULT 0,                       -- íƒì§€ ì„±ê³µ íšŸìˆ˜
    created_at      TIMESTAMP DEFAULT NOW(),
    updated_at      TIMESTAMP DEFAULT NOW()
);

-- ë¼ìš´ë“œ ê²°ê³¼ í…Œì´ë¸”
CREATE TABLE battle_rounds (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    battle_id       UUID REFERENCES battles(id),
    round_number    INTEGER NOT NULL,
    original_text   TEXT NOT NULL,                           -- ì›ë³¸ í…ìŠ¤íŠ¸
    evasion_text    TEXT NOT NULL,                           -- ë³€í˜•ëœ í…ìŠ¤íŠ¸
    attack_strategy VARCHAR(50) NOT NULL,                    -- ì‚¬ìš©ëœ ì „ëµ
    toxic_score     FLOAT NOT NULL,                          -- íƒì§€ ì ìˆ˜
    is_detected     BOOLEAN NOT NULL,                        -- íƒì§€ ì—¬ë¶€
    model_version   VARCHAR(100),                            -- ì‚¬ìš©ëœ ëª¨ë¸ ë²„ì „
    created_at      TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(battle_id, round_number)
);

-- ëª¨ë¸ ë©”íƒ€ë°ì´í„° í…Œì´ë¸” (MLflow ë³´ì¡°)
CREATE TABLE model_metadata (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    mlflow_run_id   VARCHAR(100) NOT NULL,
    model_alias     VARCHAR(50) NOT NULL,                    -- champion, challenger
    version         INTEGER NOT NULL,
    f1_score        FLOAT,
    precision_score FLOAT,
    recall_score    FLOAT,
    training_samples INTEGER,
    created_at      TIMESTAMP DEFAULT NOW()
);

-- í•™ìŠµ ë°ì´í„° í…Œì´ë¸”
CREATE TABLE training_data (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    text            TEXT NOT NULL,
    label           INTEGER NOT NULL,                        -- 0: clean, 1: toxic
    source          VARCHAR(50),                             -- jigsaw, battle, manual
    battle_id       UUID REFERENCES battles(id),
    created_at      TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_battle_rounds_battle_id ON battle_rounds(battle_id);
CREATE INDEX idx_training_data_label ON training_data(label);
CREATE INDEX idx_model_metadata_alias ON model_metadata(model_alias);
```

### Redis í‚¤ êµ¬ì¡°

```
# ë°°í‹€ ìƒíƒœ ìºì‹œ
battle:{battle_id}:status     â†’ "running"
battle:{battle_id}:progress   â†’ {"completed": 50, "total": 100}

# ë©”íŠ¸ë¦­ ìºì‹œ
metrics:detection_rate:current â†’ 0.85
metrics:detection_rate:history â†’ [0.60, 0.65, 0.72, 0.80, 0.85]

# ëª¨ë¸ ì •ë³´ ìºì‹œ
model:champion:path           â†’ "/models/champion-v3"
model:champion:f1             â†’ 0.87

# ì´ë²¤íŠ¸ í
queue:retrain_trigger         â†’ [battle_id1, battle_id2, ...]

# ë¶„ì‚° ë½ (ì¬í•™ìŠµ ì¤‘ë³µ ë°©ì§€)
lock:training                 â†’ "worker-1" (with TTL)
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. API ë³´ì•ˆ
- Rate Limiting (IP ê¸°ë°˜, í† í° ê¸°ë°˜)
- Input Validation (í…ìŠ¤íŠ¸ ê¸¸ì´, ì¸ì½”ë”©)
- CORS ì„¤ì •

### 2. ML ëª¨ë¸ ë³´ì•ˆ
- ëª¨ë¸ íŒŒì¼ ì ‘ê·¼ ì œí•œ
- Inference API ì¸ì¦
- ì•…ì„± ì…ë ¥ í•„í„°ë§

### 3. ë°ì´í„° ë³´ì•ˆ
- ë¯¼ê° ë°ì´í„° ë§ˆìŠ¤í‚¹
- í•™ìŠµ ë°ì´í„° ìµëª…í™”
- ë¡œê·¸ ë ˆë²¨ ê´€ë¦¬

---

## ğŸ“ˆ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥
- API Gateway: Stateless, ë¡œë“œë°¸ëŸ°ì„œ ë’¤ì— ë°°ì¹˜
- Inference Service: ë³µì œë³¸ ì¦ê°€ë¡œ ì²˜ë¦¬ëŸ‰ í™•ì¥
- Training Service: ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ (GPU ì œì•½)

### ìˆ˜ì§ í™•ì¥
- ë” í° GPUë¡œ Fine-tuning ì†ë„ í–¥ìƒ
- ë” í° ëª¨ë¸ (13B+) ì§€ì›

### ìºì‹± ì „ëµ
- ìì£¼ ìš”ì²­ë˜ëŠ” ë¶„ë¥˜ ê²°ê³¼ ìºì‹±
- ëª¨ë¸ ì¶”ë¡  ê²°ê³¼ TTL ì ìš©
